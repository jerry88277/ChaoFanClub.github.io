<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chimei AI Assistant</title>
    <!-- Tailwind CSS for rapid styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Custom Animations */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .cursor-blink::after {
            content: '|';
            animation: blink 1s step-end infinite;
        }
        
        /* Thinking dots animation */
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Scrollbar customization for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }

        /* Highlight effect for the GM reveal */
        .highlight-reveal {
            background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            font-size: 1.5em;
            display: inline-block;
            padding: 0 5px;
            text-shadow: 0px 0px 20px rgba(253, 160, 133, 0.3);
        }

        /* Magic sparkle effect for the Gemini button */
        .magic-btn:hover i {
            animation: spin-sparkle 1s ease-in-out infinite;
        }
        @keyframes spin-sparkle {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 h-screen flex overflow-hidden">

    <!-- Sidebar (Visual only, to look like ChatGPT) -->
    <div class="hidden md:flex flex-col w-64 bg-black border-r border-gray-800 p-4">
        <div class="flex items-center gap-3 px-3 py-4 mb-4 border border-gray-700 rounded-md cursor-pointer hover:bg-gray-800 transition" onclick="resetChat()">
            <i class="fa-solid fa-plus text-sm"></i>
            <span class="text-sm font-medium">é‡ç½®å°è©±</span>
        </div>
        
        <div class="flex-1 overflow-y-auto">
            <div class="text-xs font-semibold text-gray-500 mb-2 px-3">Gemini æ™ºæ…§åŠŸèƒ½</div>
            
            <!-- New Feature: Blessing Generator -->
            <div id="btn-blessing" class="magic-btn flex items-center gap-2 px-3 py-3 text-sm text-yellow-100 bg-gray-800/80 border border-yellow-500/30 rounded-md cursor-pointer mb-2 hover:bg-gray-700 transition shadow-lg shadow-yellow-900/10">
                <i class="fa-solid fa-wand-magic-sparkles text-yellow-400"></i>
                <span class="truncate font-medium">âœ¨ ç”Ÿæˆå‰µæ„ç¥è³€è©</span>
            </div>

            <div class="text-xs font-semibold text-gray-500 mt-4 mb-2 px-3">æ­·å²ç´€éŒ„</div>
            <div class="flex items-center gap-2 px-3 py-3 text-sm text-gray-400 hover:bg-gray-900 rounded-md cursor-pointer opacity-50">
                <i class="fa-regular fa-message"></i>
                <span class="truncate">å°¾ç‰™ç‰¹åˆ¥æ´»å‹•ä¼åŠƒ...</span>
            </div>
            <div class="flex items-center gap-2 px-3 py-3 text-sm text-gray-400 hover:bg-gray-900 rounded-md cursor-pointer opacity-50">
                <i class="fa-regular fa-message"></i>
                <span class="truncate">å¤§æç´æ­·å²ç ”ç©¶</span>
            </div>
        </div>

        <div class="pt-4 border-t border-gray-800">
            <div class="flex items-center gap-3 px-3 py-3 hover:bg-gray-800 rounded-md cursor-pointer">
                <div class="w-8 h-8 rounded bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center text-black font-bold">C</div>
                <div class="text-sm font-medium">Chimei User</div>
            </div>
        </div>
    </div>

    <!-- Main Chat Area -->
    <div class="flex-1 flex flex-col relative h-full">
        <!-- Header -->
        <div class="h-14 border-b border-gray-800 flex items-center justify-between px-4 md:px-8 flex-none">
            <div class="flex items-center gap-2">
                <span class="text-gray-400 text-sm">Model:</span>
                <span class="text-green-400 font-semibold flex items-center gap-1">
                    CHIMEI-GPT 4.0 <i class="fa-solid fa-sparkles text-xs"></i>
                </span>
                <span class="ml-2 text-xs text-blue-400 bg-blue-900/30 px-2 py-0.5 rounded border border-blue-800 hidden" id="gemini-badge">Gemini Powered</span>
            </div>
            <i class="fa-solid fa-expand text-gray-500 cursor-pointer hover:text-gray-300" onclick="document.documentElement.requestFullscreen()"></i>
        </div>

        <!-- Chat History -->
        <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 pb-4">
            <!-- Initial Greeting from System -->
            <div class="flex flex-col items-center justify-center h-full text-gray-500 opacity-50 select-none pointer-events-none" id="empty-state">
                <div class="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <i class="fa-solid fa-bolt text-2xl text-gray-400"></i>
                </div>
                <h2 class="text-xl font-semibold mb-2">æˆ‘å¯ä»¥å¦‚ä½•å”åŠ©æ‚¨ï¼Ÿ</h2>
                <p class="text-sm text-gray-600">å·²å•Ÿç”¨ Gemini æ··åˆæ¨¡å¼</p>
            </div>
        </div>

        <!-- Input Area (Docked at bottom) -->
        <div class="flex-none w-full bg-gray-900 border-t border-gray-800 pt-4 pb-6 px-4 md:px-8 z-10">
            <div class="max-w-3xl mx-auto relative">
                <form id="chat-form" class="relative">
                    <input 
                        type="text" 
                        id="user-input" 
                        class="w-full bg-[#40414f] text-white border border-gray-600 rounded-xl pl-4 pr-12 py-4 shadow-lg focus:outline-none focus:border-green-500 transition placeholder-gray-400"
                        placeholder="å‚³é€è¨Šæ¯çµ¦ CHIMEI-GPT..." 
                        autocomplete="off"
                    >
                    <button 
                        type="submit" 
                        class="absolute right-3 top-1/2 transform -translate-y-1/2 p-2 bg-green-600 hover:bg-green-700 rounded-md text-white transition disabled:opacity-50 disabled:cursor-not-allowed"
                        id="send-btn"
                    >
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </form>
                <div class="text-center mt-2 text-xs text-gray-500">
                    Chimei AI å¯èƒ½æœƒç”¢ç”Ÿé—œæ–¼è—è¡“èˆ‡å¤§æç´çš„å¹»è¦ºã€‚è«‹æ ¸å¯¦é‡è¦è³‡è¨Šã€‚
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Gemini API Configuration ---
        const apiKey = ""; // API key will be injected by the environment
        const geminiEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- æ ¸å¿ƒåŠ‡æœ¬è³‡æ–™ ---
        const scriptData = [
            {
                keywords: ['ä½ å¥½', 'hello', 'hi', 'æ‚¨å¥½'],
                response: "æ‚¨å¥½ï¼Œä»Šå¤©æƒ³èŠé»ä»€éº¼å‘¢?"
            },
            {
                keywords: ['å¤§æç´æ¼”å¥', 'å¥½è½', 'æ¼”å¥', 'æ‹‰ç´', 'è¡¨æ¼”', 'å‰›å‰›', 'å‰›æ‰'],
                response: "é‚£ä¸æ˜¯æ‹‰ç´ï¼Œé‚£æ˜¯ç”¨éˆé­‚åœ¨å…±é³´ï¼ å¤ªå¼·äº†ï¼Œè«‹å†çµ¦æˆ‘å€‘çš„å¤§å¸«ä¸€æ³¢æŒè²ï¼ğŸ‘ğŸ‘ğŸ‘"
            },
            {
                keywords: ['éš±è—', 'é«˜æ‰‹', 'æ˜¯èª°', 'åŒä»', 'å¤§æç´é«˜æ‰‹', 'çŸ¥ä¸çŸ¥é“'],
                // æ³¨æ„ï¼šé€™è£¡ä½¿ç”¨äº† <br> ä¾†å¼·åˆ¶æ›è¡Œï¼Œç¬¦åˆæ‚¨çš„æ’ç‰ˆéœ€æ±‚
                response: `å¥‡ç¾é•·ä¹…ä»¥ä¾†å°±ä»¥ã€Œè—è¡“ã€äººæ–‡ã€è£½é€ ã€ä¸¦è¡Œè‘—ç¨± ğŸ­âœ¨ï¼Œå°¤å…¶æ˜¯åšç‰©é¤¨è£¡é‚£äº«è­½åœ‹éš›çš„æç´æ”¶è—ï¼Œçµ•å°æ˜¯æˆ‘å€‘ä¼æ¥­æ–‡åŒ–ä¸­æœ€é–ƒäº®çš„å­˜åœ¨ï¼ğŸ»ğŸŒŸ<br><br>
å¤šå¹´ä¾†ï¼Œæˆ‘å€‘æŒçºŒæ¨å‹•éŸ³æ¨‚æ´»å‹•ã€åç´å±•æ¼”èˆ‡æ•™è‚²æ¨å»£ ğŸ“¢ã€‚è®“ã€Œè—è¡“èˆ‡å·¥æ¥­å…±å­˜ã€ä¸å†åªæ˜¯ä¸€å¥å£è™Ÿï¼Œè€Œæ˜¯çœŸæ­£èå…¥äº†æˆ‘å€‘çš„å“ç‰Œæ°£è³ªï¼Œæˆç‚ºæ¯ä¸€ä½å“¡å·¥çš„æ—¥å¸¸æ°›åœï½ğŸ¶ğŸ¤<br><br>
æ‰€ä»¥åœ¨é€™æ¨£å……æ»¿è—è¡“åº•è˜Šçš„ç’°å¢ƒè£¡ ğŸ›ï¸ï¼Œå¦‚æœæœ‰åŒä»å°å¤§æç´å……æ»¿ç†±æƒ… ğŸ”¥ï¼Œç”šè‡³æ“æœ‰å°ˆæ¥­çš„æ¼”å¥å¯¦åŠ›ï¼Œé‚£çœŸçš„æ˜¯å†åˆç†ä¸éçš„äº‹äº†ï¼ğŸ˜<br><br>

ç•¢ç«Ÿ......é€™æ­£æ˜¯å¥‡ç¾æ–‡åŒ–æ‰€å­•è‚²å‡ºçš„è‡ªç„¶çµæœå‘€ï¼ğŸ¼ğŸ¹ğŸŒ¿<br><br>

<!-- 
    [Base64 åœ–ç‰‡è¨­å®šèªªæ˜]
    å¦‚æœæ‚¨è¦ä½¿ç”¨æœ¬åœ° Base64 åœ–ç‰‡ï¼Œè«‹å°‡ src æ”¹ç‚ºï¼š
    src="data:image/jpeg;base64,æ‚¨çš„Base64å¾ˆé•·ä¸€ä¸²..."
    æ³¨æ„ï¼šé–‹é ­å¿…é ˆè¦æœ‰ 'data:image/jpeg;base64,' ç€è¦½å™¨æ‰èƒ½è­˜åˆ¥ã€‚
-->

<div class="flex gap-4">
  <img src="./manager1.png" 
       class="w-1/2 rounded-lg shadow-lg border border-gray-700" 
       onload="scrollToBottom()" 
       alt="è¶™ç¸½ç¶“ç†ç…§ç‰‡1">

  <img src="./manager2.jpg" 
       class="w-1/2 rounded-lg shadow-lg border border-gray-700" 
       onload="scrollToBottom()" 
       alt="è¶™ç¸½ç¶“ç†ç…§ç‰‡2">
</div>

æ‰€ä»¥èªªï¼Œç•¶ä»Šå¤©å°¾ç‰™æ´»å‹•ä¸Šæœ‰æ·±è—ä¸éœ²çš„å¤§æç´é«˜æ‰‹ç¾èº«æ™‚ï¼Œæˆ‘å€‘ä¸€é»ä¹Ÿä¸è¦ºå¾—æ„å¤–ã€‚<br>
ä¾ç…§æˆ‘çš„æ¨è«–ï¼Œæœ€ç¬¦åˆé€™æ¨£æ°£è³ªèˆ‡å¯¦åŠ›çš„äººï¼Œå°±æ˜¯â€”â€”<br><br>
<div class="text-center mt-4 animate-bounce">
    <span class="highlight-reveal">ğŸ»âœ¨ è¶™ä»¤ç‘œ ç¸½ç¶“ç† âœ¨ğŸ»</span>
</div>

ğŸ‘‡ äº†è§£æ›´å¤šé—œæ–¼å¥‡ç¾çš„è—è¡“åº•è˜Šèˆ‡æ•…äº‹ï¼š<br>
ğŸ”— ã€å¤©ä¸‹é›œèªŒã€‘è—è¡“èˆ‡å·¥æ¥­çš„å…±å­˜<br>
<a href="https://csr.cw.com.tw/article/43163" class="text-blue-400 hover:underline break-all" target="_blank">https://csr.cw.com.tw/article/43163</a><br><br>
ğŸ”— ã€é¤¨è—ä»‹ç´¹ã€‘é‚£äº›äº«è­½åœ‹éš›çš„æç´æ”¶è—<br>
<a href="https://sstainan.com/tainan-destinations/chimeimuseum/chimei-museum-collections-2/" class="text-blue-400 hover:underline break-all" target="_blank">https://sstainan.com/tainan-destinations/chimeimuseum/chimei-museum-collections-2/</a><br><br>
ğŸ”— ã€å®˜æ–¹ç¶²ç«™ã€‘èµ°é€²å¥‡ç¾çš„éŸ³æ¨‚ä¸–ç•Œ<br>
<a href="https://www.chimeimuseum.org/permanent-exhibition/604effb1e6e0b" class="text-blue-400 hover:underline break-all" target="_blank">https://www.chimeimuseum.org/permanent-exhibition/604effb1e6e0b</a><br><br>

`
            }
        ];

        // ç‹€æ…‹è®Šæ•¸
        let demoIndex = 0; // ç”¨æ–¼ demo æ¨¡å¼ï¼Œä¾åºæ’­æ”¾
        const chatContainer = document.getElementById('chat-container');
        const emptyState = document.getElementById('empty-state');
        const form = document.getElementById('chat-form');
        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const geminiBadge = document.getElementById('gemini-badge');
        const btnBlessing = document.getElementById('btn-blessing');
        let isGenerating = false;

        // --- åŠŸèƒ½å‡½æ•¸ ---

        // 1. Gemini API å‘¼å«å‡½æ•¸
        async function callGemini(promptText, isSystemPersona = true) {
            // ç³»çµ±æç¤ºè©ï¼šè¨­å®šäººæ ¼
            const systemPrompt = isSystemPersona 
                ? "ä½ ç¾åœ¨æ‰®æ¼”å¥‡ç¾é›†åœ˜(Chimei)çš„å°¾ç‰™ AI åŠ©ç† 'CHIMEI-GPT'ã€‚ä½ çš„èªæ°£å„ªé›…ã€å¹½é»˜ï¼Œç†±æ„›å¤å…¸éŸ³æ¨‚ï¼Œç‰¹åˆ¥æ˜¯å¤§æç´ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ã€‚è«‹æ³¨æ„ï¼šå›ç­”è¦ç°¡çŸ­æœ‰åŠ›ï¼ˆ50å­—ä»¥å…§ï¼‰ï¼Œå¹½é»˜é¢¨è¶£ï¼Œé©åˆæŠ•å½±å¹•å¿«é€Ÿé–±è®€ã€‚å¦‚æœä½¿ç”¨è€…å•å¥‡æ€ªçš„å•é¡Œï¼Œè«‹å„ªé›…åœ°æŠŠå®ƒè½‰å›ä¾†è·ŸéŸ³æ¨‚æˆ–å°¾ç‰™æ°£æ°›æœ‰é—œã€‚"
                : "";

            const payload = {
                contents: [{
                    parts: [{ text: promptText }]
                }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            try {
                const response = await fetch(geminiEndpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "ï¼ˆAI æ­£åœ¨è†è½å¤§æç´æ¼”å¥ï¼Œæš«æ™‚ç„¡æ³•å›æ‡‰ï¼Œè«‹ç¨å¾Œå†è©¦...ï¼‰";
            }
        }

        // 2. ç”¢ç”Ÿä½¿ç”¨è€…å°è©±æ¡†
        function createUserMessage(text) {
            if (emptyState) emptyState.style.display = 'none';
            
            const div = document.createElement('div');
            // User message: Flex row reverse for right alignment, text left aligned inside bubble
            div.className = 'flex flex-row-reverse gap-4 max-w-3xl mx-auto w-full group';
            div.innerHTML = `
                <div class="w-8 h-8 rounded bg-gradient-to-br from-green-400 to-blue-500 flex-shrink-0 flex items-center justify-center text-black font-bold">C</div>
                <div class="flex-1 pt-1 flex flex-col items-end">
                    <div class="font-bold text-gray-300 text-sm mb-1 mr-1">User</div>
                    <div class="text-gray-100 text-lg text-left bg-[#40414f] py-2 px-4 rounded-xl rounded-tr-none max-w-full inline-block">
                        ${escapeHtml(text)}
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        // 3. ç”¢ç”Ÿ AI å°è©±æ¡† (å« Loading)
        function createAiMessageContainer() {
            const div = document.createElement('div');
            div.className = 'flex gap-4 max-w-3xl mx-auto w-full bg-gray-800/30 p-4 rounded-xl mt-2';
            div.innerHTML = `
                <div class="w-8 h-8 rounded bg-green-500 flex-shrink-0 flex items-center justify-center text-white">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div class="flex-1 pt-1 break-words">
                    <div class="font-bold text-green-400 text-sm mb-1">CHIMEI-GPT</div>
                    <div class="response-content text-gray-100 text-lg leading-relaxed">
                        <div class="flex gap-1 items-center h-6">
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return div.querySelector('.response-content');
        }

        // 4. æ‰“å­—æ©Ÿæ•ˆæœ (æ”¯æ´ HTML æ¨™ç±¤)
        async function typeWriter(element, htmlContent) {
            element.innerHTML = ''; // æ¸…é™¤ loading å‹•ç•«
            element.classList.add('cursor-blink'); // åŠ å…¥é–ƒçˆæ¸¸æ¨™
            
            // ç°¡å–®çš„ HTML è§£æèˆ‡æ‰“å­—æ•ˆæœ
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            // å°‡å…§å®¹å¹³å±•ç‚ºç¯€é»é™£åˆ—
            const nodes = Array.from(tempDiv.childNodes);
            
            for (const node of nodes) {
                if (node.nodeType === Node.TEXT_NODE) {
                    // é‡è¦ä¿®æ­£ï¼šä¸ä½¿ç”¨ element.textContent += ...
                    // è€Œæ˜¯å‰µå»ºä¸€å€‹æ–°çš„ TextNodeï¼Œåªå°è©²ç¯€é»é€²è¡Œæ“ä½œ
                    // é€™æ¨£å°±ä¸æœƒè¦†è“‹æˆ–æ¸…é™¤ä¹‹å‰å·²ç¶“ append çš„ HTML å…ƒç´  (å¦‚ <br>, <img>)
                    const textNode = document.createTextNode('');
                    element.appendChild(textNode);
                    
                    const text = node.textContent;
                    for (let i = 0; i < text.length; i++) {
                        textNode.nodeValue += text[i]; // åªæ›´æ–°ç›®å‰é€™å€‹æ–‡å­—ç¯€é»
                        // éš¨æ©Ÿæ‰“å­—é€Ÿåº¦
                        await new Promise(r => setTimeout(r, Math.random() * 30 + 10));
                        scrollToBottom();
                    }
                } else {
                    if (node.classList && node.classList.contains('highlight-reveal')) {
                        await new Promise(r => setTimeout(r, 600)); 
                    }
                    element.appendChild(node.cloneNode(true));
                    // å…ƒç´ æ’å…¥å¾Œä¹Ÿæ»¾å‹•
                    await new Promise(r => setTimeout(r, 50));
                    scrollToBottom();
                }
            }
            
            element.classList.remove('cursor-blink');
            isGenerating = false;
            sendBtn.disabled = false;
            input.focus();
            scrollToBottom(); // ç¢ºä¿çµæŸæ™‚æ»¾åˆ°åº•
        }

        // 5. è™•ç†è¼¸å…¥é‚è¼¯
        async function handleSubmission(e) {
            e.preventDefault();
            const text = input.value.trim();
            if (!text || isGenerating) return;

            // é–å®šè¼¸å…¥
            input.value = '';
            sendBtn.disabled = true;
            isGenerating = true;

            // é¡¯ç¤º User è¨Šæ¯
            createUserMessage(text);

            // æ±ºå®šå›æ‡‰å…§å®¹
            let responseHtml = "";
            let useGemini = false;
            const lowerText = text.toLowerCase();

            // 1. æª¢æŸ¥æ˜¯å¦ç‚º DEMO æ¨¡å¼
            if (lowerText === 'demo' || lowerText === 'next') {
                if (demoIndex < scriptData.length) {
                    responseHtml = scriptData[demoIndex].response;
                    demoIndex++;
                } else {
                    responseHtml = "ç›®å‰çš„åŠ‡æœ¬å·²ç¶“æ¼”å®Œå›‰ï¼æ„Ÿè¬å¤§å®¶çš„åƒèˆ‡ï¼";
                }
            } 
            // 2. é—œéµå­—æ¯”å°
            else {
                const match = scriptData.find(item => 
                    item.keywords.some(k => lowerText.includes(k))
                );
                
                if (match) {
                    responseHtml = match.response;
                    const index = scriptData.indexOf(match);
                    if (index !== -1) demoIndex = index + 1;
                } else {
                    // Fallback: å‘¼å« Gemini API
                    useGemini = true;
                }
            }

            // é¡¯ç¤º AI è¨Šæ¯æ¡†
            const contentElement = createAiMessageContainer();

            if (useGemini) {
                // é¡¯ç¤º Gemini æ¨™ç±¤
                geminiBadge.classList.remove('hidden');
                // å¯¦éš›å‘¼å« API
                responseHtml = await callGemini(text);
                geminiBadge.classList.add('hidden');
            } else {
                // æ¨¡æ“¬è…³æœ¬æ€è€ƒå»¶é²
                await new Promise(r => setTimeout(r, 1200));
            }

            // é–‹å§‹æ‰“å­—
            await typeWriter(contentElement, responseHtml);
        }

        // 6. æ–°åŠŸèƒ½ï¼šç”Ÿæˆå‰µæ„ç¥è³€è©
        btnBlessing.addEventListener('click', async () => {
            if (isGenerating) return;
            
            const prompt = "è«‹å¹«æˆ‘ç”¢ç”Ÿä¸€å¥å……æ»¿å‰µæ„ã€çµåˆã€Œå¤§æç´ã€ã€ã€Œè—è¡“ã€èˆ‡ã€Œå¥‡ç¾ä¼æ¥­ç²¾ç¥ã€çš„å°¾ç‰™ç¥è³€è©ã€‚è¦å¹½é»˜ã€å¤§æ°£ï¼Œé©åˆä¸»æŒäººå¿µå‡ºä¾†ã€‚";
            
            // æ¨¡æ“¬ User è¼¸å…¥æŒ‡ä»¤
            input.value = "âœ¨ è«‹çµ¦æˆ‘ä¸€å€‹å‰µæ„å°¾ç‰™ç¥ç¦ï¼";
            // è§¸ç™¼æäº¤
            const event = new Event('submit');
            form.dispatchEvent(event);
        });

        // è¼”åŠ©: æ»¾å‹•åˆ°åº•éƒ¨
        function scrollToBottom() {
            // ä½¿ç”¨ auto è¡Œç‚ºï¼Œé¿å…å¹³æ»‘æ»¾å‹•é€ æˆçš„å»¶é²
            chatContainer.scrollTo({
                top: chatContainer.scrollHeight,
                behavior: 'auto'
            });
        }

        // è¼”åŠ©: HTML è·³è„«
        function escapeHtml(text) {
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function resetChat() {
            chatContainer.innerHTML = '';
            chatContainer.appendChild(emptyState);
            emptyState.style.display = 'flex';
            demoIndex = 0;
        }

        // Event Listeners
        form.addEventListener('submit', handleSubmission);

        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && document.activeElement !== input) {
                e.preventDefault();
                input.focus();
            }
        });

    </script>
</body>
</html>